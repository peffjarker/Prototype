@* Components/Layout/NavMenu.razor *@
@using System
@using System.Linq
@using System.Collections.Generic
@using System.Threading.Tasks
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using Prototype.Components.SharedComponents.Search
@using Telerik.Blazor
@using Telerik.Blazor.Components
@using Services
@using global::Services
@implements IDisposable
@inject NavigationManager Nav
@inject IUrlState Url

<TelerikAppBar Position="AppBarPosition.Top" Class="appbar">
    <AppBarSection Class="appbar-left">
        <a href="@Url.BuildHref("/")" class="brand" aria-label="Home">
            <img class="brand-logo" src="Cornwell_Tools_logo.png" alt="IBN Logo" />
            <div class="brand-stack">
                <span class="brand-text">IBN</span>
                <span class="brand-sub">Dealer Suite</span>
            </div>
        </a>

        <div class="nav-divider" role="presentation"></div>

        <nav class="primary-nav" aria-label="Primary">
            @foreach (var item in PrimaryMenuItems)
            {
                <button type="button"
                        class="nav-item @GetActiveClass(item.Href)"
                        @onclick="@(() => OnMenuLinkClick(item.Href))"
                        title="@item.Text">
                    <TelerikSvgIcon Icon="@item.Icon" />
                    <span class="nav-label">@item.Text</span>
                </button>
            }
        </nav>
    </AppBarSection>

    <AppBarSection Class="appbar-center">
        <GlobalSearch />
    </AppBarSection>

    <AppBarSection Class="appbar-right">
        <div class="quick-actions" aria-label="Quick actions">
            <button type="button" class="action-btn" title="Help & Documentation" @onclick="NavigateToHelp">
                <TelerikSvgIcon Icon="@SvgIcon.QuestionCircle" />
            </button>

            <button type="button"
                    class="action-btn notification-btn"
                    title="Notifications"
                    @onclick="ToggleNotifications"
                    @onclick:stopPropagation="true">
                <TelerikSvgIcon Icon="@SvgIcon.Bell" />
                @if (_unreadCount > 0)
                {
                    <span class="notification-badge">@(_unreadCount > 9 ? "9+" : _unreadCount.ToString())</span>
                }
            </button>

            <button type="button" class="action-btn" title="Settings" @onclick="NavigateToSettings">
                <TelerikSvgIcon Icon="@SvgIcon.Gear" />
            </button>
        </div>

        <div class="nav-divider" role="presentation"></div>

        <TelerikDropDownButton Class="user-menu" ShowArrowButton="false">
            <DropDownButtonContent>
                <div class="user-menu-trigger" title="Account">
                    <div class="user-avatar large">
                        <span>JP</span>
                    </div>
                </div>
            </DropDownButtonContent>
            <DropDownButtonItems>
                <DropDownButtonItem OnClick="@(() => NavigateToProfile())">
                    <TelerikSvgIcon Icon="@SvgIcon.User" />
                    <span>My Profile</span>
                </DropDownButtonItem>
                <DropDownButtonItem OnClick="@(() => NavigateToDealership())">
                    <TelerikSvgIcon Icon="@SvgIcon.File" />
                    <span>My Dealership</span>
                </DropDownButtonItem>
                <DropDownButtonItem OnClick="@(() => NavigateToAnalytics())">
                    <TelerikSvgIcon Icon="@SvgIcon.ChartLineMarkers" />
                    <span>Analytics</span>
                </DropDownButtonItem>
                <DropDownButtonItem OnClick="@(() => NavigateToAppearance())">
                    <TelerikSvgIcon Icon="@SvgIcon.Palette" />
                    <span>Appearance</span>
                </DropDownButtonItem>
                <DropDownButtonItem OnClick="@(() => NavigateToSecurity())">
                    <TelerikSvgIcon Icon="@SvgIcon.Lock" />
                    <span>Security</span>
                </DropDownButtonItem>
            </DropDownButtonItems>
        </TelerikDropDownButton>
    </AppBarSection>
</TelerikAppBar>

@if (_showNotifications)
{
    <div class="notifications-overlay" @onclick="CloseNotifications"></div>
    <div class="notifications-popover" role="dialog" aria-label="Notifications">
        <div class="notifications-header">
            <h3>Notifications</h3>
            <button type="button" class="mark-read-btn" @onclick="MarkAllAsRead">Mark all read</button>
        </div>
        <div class="notifications-list">
            @if (_notifications.Any())
            {
                @foreach (var notification in _notifications)
                {
                    <div class="notification-item @(notification.IsRead ? "" : "unread")"
                         @onclick="@(() => HandleNotificationClick(notification))">
                        <TelerikSvgIcon Icon="@notification.Icon" Class="@($"notification-icon {notification.IconClass}")" />
                        <div class="notification-content">
                            <p class="notification-title">@notification.Title</p>
                            <span class="notification-time">@notification.TimeAgo</span>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="notifications-empty">
                    <TelerikSvgIcon Icon="@SvgIcon.Bell" />
                    <p>No new notifications</p>
                </div>
            }
        </div>
        <div class="notifications-footer">
            <a href="@Url.BuildHref("/notifications")" @onclick="CloseNotifications">View all notifications</a>
        </div>
    </div>
}

<TelerikDrawer TItem="object"
               @bind-Expanded="drawerOpen"
               Mode="DrawerMode.Overlay"
               Width="300px"
               Class="mobile-drawer">
    <Template>
        <div class="drawer-header">
            <a href="@Url.BuildHref("/")" class="drawer-brand">
                <img class="drawer-logo" src="Cornwell_Tools_logo.png" alt="IBN Logo" />
                <div class="brand-stack">
                    <span class="brand-text">IBN</span>
                    <span class="brand-sub">Dealer Suite</span>
                </div>
            </a>
            <button type="button" class="drawer-close" @onclick="@(() => drawerOpen = false)">
                <TelerikSvgIcon Icon="@SvgIcon.X" />
            </button>
        </div>

        <div class="drawer-user">
            <div class="user-avatar">
                <span>JD</span>
            </div>
            <div class="user-info">
                <div class="user-name">John Doe</div>
                <div class="user-role">Administrator</div>
            </div>
        </div>

        <div class="drawer-search">
            <GlobalSearch />
        </div>

        <div class="drawer-nav">
            <div class="drawer-section-title">Navigation</div>
            @foreach (var item in PrimaryMenuItems)
            {
                <div class="drawer-item @GetActiveClass(item.Href)"
                     @onclick="@(() => OnMobileMenuClick(item.Href))">
                    <TelerikSvgIcon Icon="@item.Icon" />
                    <span>@item.Text</span>
                </div>
            }
        </div>

        <div class="drawer-nav">
            <div class="drawer-section-title">Quick Actions</div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/help"))">
                <TelerikSvgIcon Icon="@SvgIcon.QuestionCircle" />
                <span>Help & Documentation</span>
            </div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/notifications"))">
                <TelerikSvgIcon Icon="@SvgIcon.Bell" />
                <span>Notifications</span>
                @if (_unreadCount > 0)
                {
                    <span class="drawer-badge">@_unreadCount</span>
                }
            </div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/settings"))">
                <TelerikSvgIcon Icon="@SvgIcon.Gear" />
                <span>Settings</span>
            </div>
        </div>

        <div class="drawer-nav">
            <div class="drawer-section-title">Account</div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/profile"))">
                <TelerikSvgIcon Icon="@SvgIcon.User" />
                <span>My Profile</span>
            </div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/dealership"))">
                <TelerikSvgIcon Icon="@SvgIcon.File" />
                <span>My Dealership</span>
            </div>
            <div class="drawer-item" @onclick="@(() => OnMobileMenuClick("/analytics"))">
                <TelerikSvgIcon Icon="@SvgIcon.ChartLineMarkers" />
                <span>Analytics</span>
            </div>
            <div class="drawer-item sign-out" @onclick="SignOut">
                <TelerikSvgIcon Icon="@SvgIcon.Logout" />
                <span>Sign Out</span>
            </div>
        </div>
    </Template>
    <DrawerContent />
</TelerikDrawer>

@code
{
    private bool drawerOpen = false;
    private bool _showNotifications = false;
    private int _unreadCount = 3;
    private string? currentPath;
    private List<NotificationItem> _notifications = new();

    private readonly List<MenuLink> PrimaryMenuItems =
    [
        new("PO Transfer", "/po-transfer/items-on-order?status=All", SvgIcon.ArrowsSwap),
        new("Product", "/product/webcat?class=All Items", SvgIcon.EditTools),
        new("Tech Credit", "/techcredit/customerinformation?status=All", SvgIcon.Dollar)
    ];

    protected override void OnInitialized()
    {
        currentPath = Nav.ToBaseRelativePath(Nav.Uri);
        Url.Changed += OnUrlChanged;
        LoadNotifications();
    }

    private void OnUrlChanged()
    {
        currentPath = Nav.ToBaseRelativePath(Nav.Uri);
        _ = InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Url.Changed -= OnUrlChanged;
    }

    private void OnMenuLinkClick(string hrefBase)
    {
        var targetModule = GetModuleFromPath(hrefBase);
        var currentModule = GetModuleFromPath("/" + currentPath?.TrimStart('/'));

        string href;
        if (targetModule != currentModule)
        {
            var preserved = new Dictionary<string, string?>(StringComparer.OrdinalIgnoreCase);
            if (Url.Has("dealer"))
            {
                preserved["dealer"] = Url.Get("dealer");
            }
            href = Url.BuildHref(hrefBase, preserved, preserveCurrentState: false);
        }
        else
        {
            href = Url.BuildHref(hrefBase);
        }

        Nav.NavigateTo(href);
    }

    private void OnMobileMenuClick(string href)
    {
        drawerOpen = false;
        OnMenuLinkClick(href);
    }

    private static string GetModuleFromPath(string path)
    {
        if (string.IsNullOrWhiteSpace(path)) return "";
        var pathOnly = path.Split('?')[0];
        var segments = pathOnly.TrimStart('/').Split('/', StringSplitOptions.RemoveEmptyEntries);
        return segments.Length > 0 ? segments[0].ToLowerInvariant() : "";
    }

    private string GetActiveClass(string href)
        => IsActive(href) ? "is-active" : string.Empty;

    private bool IsActive(string href)
    {
        if (string.IsNullOrWhiteSpace(currentPath)) return href == "/";

        // Compare by module (first path segment)
        var currentModule = GetModuleFromPath("/" + currentPath.TrimStart('/'));
        var hrefModule = GetModuleFromPath(href);

        return !string.IsNullOrEmpty(hrefModule) &&
               string.Equals(currentModule, hrefModule, StringComparison.OrdinalIgnoreCase);
    }

    private void ToggleNotifications() => _showNotifications = !_showNotifications;

    private void CloseNotifications() => _showNotifications = false;

    private void MarkAllAsRead()
    {
        foreach (var n in _notifications) n.IsRead = true;
        _unreadCount = 0;
        StateHasChanged();
    }

    private void HandleNotificationClick(NotificationItem notification)
    {
        notification.IsRead = true;
        _unreadCount = _notifications.Count(n => !n.IsRead);

        if (!string.IsNullOrEmpty(notification.NavigationUrl))
        {
            Nav.NavigateTo(notification.NavigationUrl);
            _showNotifications = false;
        }

        StateHasChanged();
    }

    private void NavigateToHelp() => Nav.NavigateTo(Url.BuildHref("/help"));
    private void NavigateToSettings() => Nav.NavigateTo(Url.BuildHref("/settings"));
    private void NavigateToProfile() => Nav.NavigateTo(Url.BuildHref("/profile"));
    private void NavigateToDealership() => Nav.NavigateTo(Url.BuildHref("/dealership"));
    private void NavigateToAnalytics() => Nav.NavigateTo(Url.BuildHref("/analytics"));
    private void NavigateToAppearance() => Nav.NavigateTo(Url.BuildHref("/settings/appearance"));
    private void NavigateToSecurity() => Nav.NavigateTo(Url.BuildHref("/settings/security"));

    private void SignOut() => Nav.NavigateTo("/auth/signout", forceLoad: true);

    private void LoadNotifications()
    {
        _notifications = new List<NotificationItem>
        {
            new NotificationItem { Id = 1, Title = "New PO #45231 received", TimeAgo = "5 minutes ago", Icon = SvgIcon.Cart,            IsRead = false, NavigationUrl = "/po-transfer/purchase-orders" },
            new NotificationItem { Id = 2, Title = "Invoice #12456 paid",   TimeAgo = "1 hour ago",    Icon = SvgIcon.CheckCircle,     IsRead = false, NavigationUrl = "/invoices/12456" },
            new NotificationItem { Id = 3, Title = "Low inventory alert: 5 items", TimeAgo = "2 hours ago", Icon = SvgIcon.ExclamationCircle, IsRead = false, NavigationUrl = "/product/inventory" }
        };

        _unreadCount = _notifications.Count(n => !n.IsRead);
    }

    public sealed class MenuLink(string text, string href, ISvgIcon icon)
    {
        public string Text { get; } = text;
        public string Href { get; } = href;
        public ISvgIcon Icon { get; } = icon;
    }

    public class NotificationItem
    {
        public int Id { get; set; }
        public string Title { get; set; } = "";
        public string TimeAgo { get; set; } = "";
        public ISvgIcon Icon { get; set; } = SvgIcon.Bell;
        public string IconClass { get; set; } = "";
        public bool IsRead { get; set; }
        public string? NavigationUrl { get; set; }
    }
}

<style>
    /* --- App bar --- */
    .appbar {
        position: sticky;
        top: 0;
        z-index: 5000;
        min-height: 64px;
        background: var(--app-bg);
        border-bottom: 1px solid var(--nav-border);
        box-shadow: var(--nav-shadow);
    }

        /* Wrapper for flexible layout */
        .appbar .k-appbar-section-flow {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
        }

    /* sections */
    .appbar-left,
    .appbar-right {
        display: flex;
        align-items: center;
        gap: 12px;
        padding-inline: 20px;
        padding-block: 10px;
    }

    .appbar-left {
        flex: 0 1 auto;
    }

    .appbar-right {
        flex: 0 0 auto;
        margin-left: auto;
    }

    .appbar-center {
        flex: 0 1 auto;
        display: flex;
        justify-content: center;
        max-width: 480px;
        min-width: 280px;
        padding: 0 12px;
        padding-block: 10px;
    }

    /* --- Brand --- */
    .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: var(--text);
        margin-right: 8px;
        flex-shrink: 0;
    }

        .brand:hover {
            opacity: 0.9;
        }

    .brand-logo {
        width: 32px;
        height: 32px;
        object-fit: contain;
    }

    .brand-stack {
        display: flex;
        flex-direction: column;
        gap: 2px;
    }

    .brand-text {
        font-size: 16px;
        font-weight: 700;
        letter-spacing: -0.01em;
        color: var(--text);
        line-height: 1;
    }

    .brand-sub {
        font-size: 11px;
        font-weight: 500;
        color: var(--text-muted);
        line-height: 1;
    }

    /* --- Divider --- */
    .nav-divider {
        width: 1px;
        height: 32px;
        background: var(--nav-border);
        margin-inline: 4px;
        flex-shrink: 0;
    }

    /* --- Primary navigation --- */
    .primary-nav {
        display: flex;
        align-items: center;
        gap: 4px;
        flex-shrink: 0;
    }

    .nav-item {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 9px 14px;
        border: 0;
        border-radius: var(--border-radius);
        background: transparent;
        font-size: 14px;
        font-weight: 500;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        cursor: pointer;
        transition: all 0.15s ease;
        position: relative;
        white-space: nowrap;
        color: var(--muted);
    }

        .nav-item:hover {
            background: var(--hover-bg);
            color: var(--text);
        }

        .nav-item.is-active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            font-weight: 600;
        }

        .nav-item .k-svg-icon {
            font-size: 18px;
        }

    /* label visibility */
    .nav-label {
        display: inline-block;
    }

    /* --- Quick actions --- */
    .quick-actions {
        display: flex;
        align-items: center;
        gap: 4px;
        flex-shrink: 0;
    }

    .action-btn {
        position: relative;
        width: 40px;
        height: 40px;
        display: grid;
        place-items: center;
        background: transparent;
        border: 0;
        border-radius: var(--border-radius);
        color: var(--muted);
        cursor: pointer;
        transition: all 0.15s ease;
        flex-shrink: 0;
    }

        .action-btn:hover {
            background: var(--hover-bg);
            color: var(--text);
        }

        .action-btn .k-svg-icon {
            font-size: 20px;
        }

    .notification-badge {
        position: absolute;
        top: 6px;
        right: 6px;
        min-width: 18px;
        height: 18px;
        padding: 0 5px;
        font-size: 11px;
        font-weight: 700;
        background: var(--danger);
        color: #fff;
        border-radius: 10px;
        display: grid;
        place-items: center;
        border: 2px solid var(--nav-bg);
    }

    /* --- User menu --- */
    .user-menu {
        background: transparent !important;
        border: 1px solid var(--nav-border) !important;
        border-radius: 8px !important;
        padding: 0 !important;
        transition: all 0.15s ease !important;
        flex-shrink: 0 !important;
    }

        .user-menu:hover {
            background: var(--hover-bg) !important;
            border-color: var(--text-muted) !important;
        }

    .user-menu-trigger {
        display: flex;
        align-items: center;
        padding: 4px;
    }

    .user-avatar {
        width: 32px;
        height: 32px;
        border-radius: 6px;
        display: grid;
        place-items: center;
        color: #fff;
        font-weight: 600;
        font-size: 13px;
        background: var(--accent);
    }

        .user-avatar.large {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }

    .k-dropdownbutton-item {
        display: flex !important;
        align-items: center !important;
        gap: 12px !important;
        padding: 10px 14px !important;
        border-radius: 6px !important;
        font-size: 14px !important;
        color: var(--text) !important;
    }

        .k-dropdownbutton-item:hover {
            background: var(--hover-bg) !important;
        }

        .k-dropdownbutton-item .k-svg-icon {
            font-size: 18px;
            color: var(--text-muted);
        }

    /* --- Notifications --- */
    .notifications-overlay {
        position: fixed;
        inset: 0;
        z-index: 5000;
        background: var(--overlay);
        animation: fadeIn 0.2s ease;
    }

    @@keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .notifications-popover {
        position: fixed;
        top: 72px;
        right: 24px;
        width: 400px;
        max-height: 560px;
        background: var(--nav-bg);
        color: var(--text);
        border: 1px solid var(--nav-border);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15), 0 0 1px rgba(0, 0, 0, 0.1);
        z-index: 5001;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        animation: slideDown 0.2s ease;
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .notifications-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px 18px;
        border-bottom: 1px solid var(--nav-border);
    }

        .notifications-header h3 {
            margin: 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text);
        }

    .mark-read-btn {
        background: none;
        border: 0;
        color: var(--accent);
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        padding: 4px 8px;
        transition: all 0.15s ease;
    }

        .mark-read-btn:hover {
            background: var(--hover-bg);
        }

    .notifications-list {
        flex: 1;
        overflow: auto;
    }

    .notification-item {
        display: flex;
        gap: 12px;
        padding: 14px 18px;
        cursor: pointer;
        transition: background 0.15s ease;
        border-left: 2px solid transparent;
    }

        .notification-item:hover {
            background: var(--hover-bg);
        }

        .notification-item.unread {
            border-left-color: var(--accent);
        }

        .notification-item + .notification-item {
            border-top: 1px solid var(--nav-border);
        }

    .notification-icon {
        width: 36px;
        height: 36px;
        padding: 8px;
        background: var(--hover-bg);
        color: var(--text-muted);
        flex-shrink: 0;
    }

        .notification-icon.success {
            background: #dcfce7;
            color: #16a34a;
        }

        .notification-icon.warning {
            background: #fed7aa;
            color: #ea580c;
        }

    @@media (prefers-color-scheme: dark) {
        .notification-icon.success {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }

        .notification-icon.warning {
            background: rgba(251, 146, 60, 0.15);
            color: #fb923c;
        }
    }

    .notification-content {
        flex: 1;
        min-width: 0;
    }

    .notification-title {
        margin: 0 0 4px;
        font-size: 14px;
        font-weight: 500;
        line-height: 1.4;
        color: var(--text);
    }

    .notification-time {
        font-size: 13px;
        color: var(--text-muted);
    }

    .notifications-empty {
        padding: 48px 24px;
        text-align: center;
        color: var(--text-muted);
    }

        .notifications-empty .k-svg-icon {
            font-size: 48px;
            opacity: 0.2;
            margin-bottom: 12px;
        }

        .notifications-empty p {
            margin: 0;
            font-size: 14px;
        }

    .notifications-footer {
        padding: 12px 18px;
        border-top: 1px solid var(--nav-border);
        text-align: center;
    }

        .notifications-footer a {
            color: var(--accent);
            font-size: 14px;
            font-weight: 600;
            text-decoration: none;
            transition: opacity 0.15s ease;
        }

            .notifications-footer a:hover {
                opacity: 0.8;
            }

    /* --- Mobile drawer --- */
    .mobile-menu-btn {
        display: none;
    }

    .mobile-drawer .k-drawer-wrapper {
        background: var(--surface);
        z-index: 6000;
    }

    .drawer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 16px;
        border-bottom: 1px solid var(--nav-border);
    }

    .drawer-brand {
        display: flex;
        align-items: center;
        gap: 12px;
        text-decoration: none;
        color: var(--text);
    }

    .drawer-logo {
        width: 32px;
        height: 32px;
        object-fit: contain;
    }

    .drawer-close {
        width: 40px;
        height: 40px;
        display: grid;
        place-items: center;
        background: transparent;
        border: 0;
        border-radius: var(--border-radius);
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.15s ease;
    }

        .drawer-close:hover {
            background: var(--hover-bg);
            color: var(--text);
        }

    .drawer-user {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: var(--hover-bg);
        border-bottom: 1px solid var(--nav-border);
    }

    .user-info {
        flex: 1;
        min-width: 0;
    }

    .user-name {
        font-size: 15px;
        font-weight: 600;
        color: var(--text);
        margin-bottom: 2px;
    }

    .user-role {
        font-size: 13px;
        color: var(--text-muted);
    }

    .drawer-search {
        padding: 16px;
        border-bottom: 1px solid var(--nav-border);
    }

    .drawer-nav {
        padding: 12px;
    }

        .drawer-nav + .drawer-nav {
            border-top: 1px solid var(--nav-border);
        }

    .drawer-section-title {
        padding: 8px 12px;
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: var(--text-muted);
    }

    .drawer-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: var(--border-radius);
        color: var(--text-secondary);
        font-size: 15px;
        cursor: pointer;
        transition: all 0.15s ease;
        position: relative;
    }

        .drawer-item:hover {
            background: var(--hover-bg);
            color: var(--text);
        }

        .drawer-item.is-active {
            background: var(--active-bg);
            color: var(--active-text);
            font-weight: 600;
        }

        .drawer-item .k-svg-icon {
            font-size: 20px;
        }

        .drawer-item.sign-out {
            color: var(--danger);
        }

            .drawer-item.sign-out:hover {
                background: rgba(220, 38, 38, 0.1);
            }

    .drawer-badge {
        margin-left: auto;
        min-width: 20px;
        height: 20px;
        padding: 0 6px;
        background: var(--danger);
        color: #fff;
        font-size: 12px;
        font-weight: 700;
        border-radius: 10px;
        display: grid;
        place-items: center;
    }

    /* --- Responsive Breakpoints --- */

    /* Large screens - reduce search max-width */
    @@media (max-width: 1400px) {
        .appbar-center {
            max-width: 420px;
        }
    }

    /* Medium screens - hide brand subtitle, reduce search further */
    @@media (max-width: 1200px) {
        .brand-sub {
            display: none;
        }

        .appbar-center {
            max-width: 360px;
        }
    }

    /* Small screens - Search wraps to second line and gets smaller */
    @@media (max-width: 1100px) {
        .appbar {
            min-height: auto;
        }

        .appbar-center {
            order: 3;
            flex: 1 1 100%;
            max-width: 100%;
            min-width: 0;
            padding-inline: 20px;
            padding-top: 0;
            padding-bottom: 10px;
        }
    }

    /* Tablets - hide nav labels, show icons only */
    @@media (max-width: 1024px) {
        .nav-label {
            display: none;
        }

        .nav-item {
            padding: 9px 10px;
            min-width: 40px;
            justify-content: center;
        }

        .appbar-left,
        .appbar-right {
            padding-inline: 16px;
            gap: 8px;
        }
    }

    /* Smaller tablets - make search even smaller on second line */
    @@media (max-width: 900px) {
        .action-btn:first-child {
            display: none; /* Hide help button */
        }

        .appbar-center {
            max-width: 600px; /* Restrict width on second line */
        }
    }

    /* Small tablets - further restrict search width */
    @@media (max-width: 800px) {
        .appbar-center {
            max-width: 500px;
        }
    }

    /* Even smaller - continue shrinking search */
    @@media (max-width: 700px) {
        .appbar-center {
            max-width: 400px;
        }
    }

    /* Very small - final shrink before mobile */
    @@media (max-width: 600px) {
        .appbar-center {
            max-width: 320px;
        }

        .appbar-left,
        .appbar-right {
            gap: 6px;
        }
    }

    /* Small phones - Compact everything */
    @@media (max-width: 400px) {
        .appbar-left,
        .appbar-right {
            padding-inline: 12px;
            gap: 4px;
        }

        .brand-logo {
            width: 28px;
            height: 28px;
        }

        .brand-text {
            font-size: 14px;
        }

        .mobile-menu-btn {
            width: 36px;
            height: 36px;
        }
    }

    /* Notifications responsive positioning */
    @@media (max-width: 768px) {
        .notifications-popover {
            right: 12px;
            width: calc(100vw - 24px);
            max-width: 400px;
            top: 64px;
        }
    }

    @@media (max-width: 480px) {
        .notifications-popover {
            right: 8px;
            width: calc(100vw - 16px);
        }
    }

    /* --- Scrollbars --- */
    .notifications-list::-webkit-scrollbar {
        width: 6px;
    }

    .notifications-list::-webkit-scrollbar-track {
        background: transparent;
    }

    .notifications-list::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 3px;
    }

        .notifications-list::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.2);
        }

    @@media (prefers-color-scheme: dark) {
        .notifications-list::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
        }

            .notifications-list::-webkit-scrollbar-thumb:hover {
                background: rgba(255, 255, 255, 0.2);
            }
    }
</style>